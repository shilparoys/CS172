<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head> 
  <title></title> 
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport"> 
  <meta name="apple-mobile-web-app-capable" content="yes"> 
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script> 
  <link rel="stylesheet" href="//code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css"> 
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.css"> 
  <link rel="stylesheet" href="http://demos.jquerymobile.com/1.4.0/theme-classic/theme-classic.css"> 
  <!--    <link rel="stylesheet" href="http://demos.jquerymobile.com/1.3.0-rc.1/css/themes/default/jquery.mobile-1.3.0-rc.1.css" />--> 
  <script type="text/javascript" src="//code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script> 
  <script type="text/javascript">
        var referrer;
        $(document).ready(function () {
            referrer = document.referrer;

        });
        function getQueryStrings() {
            var queryStringColl = null;
            var requestUrl = window.location.search.toString();
            var url = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');

            if (requestUrl != '') {
                requestUrl = requestUrl.substring(1);
                queryStringColl = new Array();

                var kvPairs = requestUrl.split('&');

                for (var i = 0; i < kvPairs.length; i++) {
                    var kvPair = kvPairs[i].split('=');
                    queryStringColl[kvPair[0]] = kvPair[1];
                }
            }
            return queryStringColl;
        }
        //MagazineFeatures
        var PasswordRestricted;
        var Password;
        var allow = 0;
        var id;
        $(window).load(function () {
            $.mobile.loading('show');
            // alert(sessionStorage.restricted);
            //            var queryStringColl = getQueryStrings();
            //            if (queryStringColl == null) {
            //                return;
            //            }

            //            var id = queryStringColl['id'];
            //   id = queryStringColl['id'];
            id = '54073';
            if (id == 50162 && sessionStorage.restricted == 1) {
                window.location.replace("http://www.pageturnpro.com");
                return;
            }
            $("#passwordPopUp").popup("close");
          //  var NewpageUrl = "http://" + window.location.host + "/trunk/ptpmviewer/WebService.asmx/GetPublicationFeatures";
          //  alert(NewpageUrl);
            $.ajax({
                type: "POST",
                dataType: 'xml',
                url: '/ptpmviewer/WebService.asmx/GetPublicationFeatures',
                data: "strPubID=" + id,
                success: function (xml) {
                    $.mobile.loading('hide');
                    var $books = $(xml).find("Table1");
                    $.each($books, function (count, rec) {
                        PasswordRestricted = $(this).find('bProtected').text();
                        if (PasswordRestricted == 'true') {
                            Password = $(rec).children('vcViewingKey').text();
                        }
                        if (PasswordRestricted == 'true') {
                            $("#passwordPopUp").popup("open");
                            return;
                        }
                        else {                           
                            //  window.document.location.href = 'Gallery.htm?id=' + id + '&i=0';
                            window.document.location.href = 'mdefault.html';
                        }

                    });
                },
                error: function (xhr, errorType, exception) {
                    var errorMessage = exception || xhr.statusText;
                    //alert("There was an error creating your contact: " + errorMessage);
                }
            });
            //            if (PasswordRestricted == 'true') {
            //                $("#passwordPopUp").popup("open");
            //                return;
            //            }
            //            else {
            //                window.document.location.href = 'Gallery.htm?id=' + id + '&i=0';
            //            }

        });


        $(document).on('click', '#btnPwdSubmit', function () {
            var pubPassword = $('#password').val();
            if (pubPassword.length == 0) {
                alert("Please enter password");
                return false;
            }
            else {
                if (pubPassword == Password) {
                    $("#passwordPopUp").popup("close");
                    //  window.document.location.href = 'Gallery.htm?id=' + id + '&i=0';
                    window.document.location.href = 'mdefault.html';
                    //return;
                }
                else {
                    alert("Invalid password");
                    return;
                }
            }
        });

        $(document).on('click', '#btnPwdCancel', function () {
            $('#password').val("");
            $('#password').focus();
            return false;
        });
       
       
    </script> 
 </head> 
 <body> 
  <!--    <div data-role="popup" id="passwordPopUp" class="ui-content" data-overlay-theme="a"
        data-theme="a">
        <div data-role="fieldcontain">
            <label style="background-color: Gray; color: White; font-weight: bold;" for="name">
                Enter Password:</label>
            <br />
            <label for="password">
                Enter your password here <span style="color: Red;">*</span></label>
            <input type="password" name="password" id="password" /><br />
            <div class="btnse">
                <a href="#" data-role="button" data-inline="true" id="btnPwdSubmit">Submit</a> <a
                    href="#" data-role="button" data-inline="true" data-theme="c" id="btnPwdCancel">
                    Cancel</a>
                <!--  <input class="ui-btn-hidden" data-theme="c" type="button" value="Submit" />  
                   <input  class="ui-btn-hidden" data-theme="c" type="reset" value="Reset"  />--> 
  <!--</div> </div> </div>--> 
  <div class="ui-popup-container pop in ui-popup-active" id="popupDialog-popup" tabindex="0"> 
   <div class="ui-corner-all ui-popup ui-body-c ui-overlay-shadow" style="max-width: 400px;" data-dismissible="false" data-theme="c" data-overlay-theme="a" id="passwordPopUp" data-role="popup" aria-disabled="false" data-disabled="false" data-shadow="true" data-corners="true" data-transition="none" data-position-to="origin"> 
    <div class="ui-corner-top ui-header ui-bar-a" data-theme="a" data-role="header" role="banner"> 
     <h1 class="ui-title" role="heading" aria-level="1" style="overflow: visible;"> Enter Password</h1> 
    </div> 
    <div class="ui-corner-bottom ui-content ui-body-d" data-theme="d" data-role="content" role="main"> 
     <h3 class="ui-title"> Enter your password here <span style="color: Red;">*</span></h3> 
     <input type="password" name="password" id="password" placeholder="Enter password"> 
     <div style="margin:0px auto; text-align:center;"> 
      <a id="btnPwdSubmit" data-theme="b" data-transition="flow" data-inline="true" data-role="button" href="#" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-shadow ui-btn-corner-all ui-btn-inline ui-btn-up-b"><span class="ui-btn-inner"> <span class="ui-btn-text">Go</span></span></a> 
      <a id="btnPwdCancel" data-theme="c" data-inline="true" data-role="button" href="#" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="ui-btn ui-shadow ui-btn-corner-all ui-btn-inline ui-btn-up-c"> <span class="ui-btn-inner"><span class="ui-btn-text">Cancel</span></span></a> 
     </div> 
    </div> 
   </div> 
  </div>   
 </body>
</html>